(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0fe33a7c"],{"06ba":function(e,t,s){},"085a":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("main",{attrs:{id:"mmessage-container"}},[s("p",{staticClass:"title"},[e._v("消息通知")]),0!=e.$store.state.messageList.length?s("ul",{staticClass:"message-list"},e._l(e.$store.state.messageList,function(t){return s("li",{key:t.id,class:{ones:!0,already:1===t.is_read},on:{click:function(s){return e.watchOnce(t)}}},[s("span",{staticStyle:{"font-weight":"900",float:"left","padding-right":"3px"}},[e._v("·")]),e._v(" "),s("span",{staticClass:"ones-left"},[e._v(e._s(t.title))]),s("div",{staticClass:"ones-right"},[s("span",{staticStyle:{float:"left"}},[e._v(e._s(t.push_time.substring(0,11).trim()))]),s("el-button",{staticStyle:{padding:"22px",float:"right"},attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.deleteOnce(t)}}},[e._v("删除")])],1)])}),0):s("div",{staticClass:"messageNone message-list"},[s("p",{staticClass:"messageNone-text"},[e._v("暂无消息")])]),s("div",{staticClass:"already-read"},[s("el-button",{staticClass:"clear-btn",attrs:{type:"primary",size:"small",plain:""},on:{click:e.clearMessage}},[e._v("清空消息")]),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.alreadyRead}},[e._v("全部标记为已读")])],1),s("el-dialog",{staticClass:"dialog-message",attrs:{title:e.activeMessage.title,visible:e.messageContentFlag,width:"30%"},on:{"update:visible":function(t){e.messageContentFlag=t}}},[s("p",{staticClass:"message-content"},[e._v(e._s(e.activeMessage.content))]),s("span",{staticClass:"message-time"},[e._v(e._s(e.activeMessage.push_time.substring(0,11).trim()))]),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})])],1)},n=[],i=(s("b5aa"),s("2c46")),r={name:"Mmessage",data:function(){return{token:"",messageContentFlag:!1,activeMessage:{title:"",content:"",push_time:""}}},methods:{alreadyRead:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(0!==this.$store.state.messageList.length){e.next=3;break}return this.$message({type:"warning",message:"无消息记录!"}),e.abrupt("return",!1);case 3:return e.next=5,this.$axios.get("updateStatus",{headers:{Authorization:"Bearer ".concat(this.token)}});case 5:t=e.sent,200===t.code&&(this.$message({type:"success",message:"已全部设置为已读!"}),this.getMessageList());case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),clearMessage:function(){var e=this;if(0===this.$store.state.messageList.length)return this.$message({type:"warning",message:"无消息记录!"}),!1;this.$confirm("确定要删除所有消息吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark(function t(){var s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.get("emptyAll",{headers:{Authorization:"Bearer ".concat(e.token)}});case 2:s=t.sent,200===s.code?(e.$message({type:"success",message:"清空成功!"}),e.$store.commit("valChange",{type:"messageList",val:[]})):e.$message({type:"error",message:"系统繁忙, 请稍后重试!"});case 4:case"end":return t.stop()}},t)}))).catch(function(e){console.log(e)})},watchOnce:function(e){if(this.activeMessage=e,this.messageContentFlag=!0,1===e.is_read)return!1;e.is_read=1,this.$axios.get("/messages/".concat(e.id),{headers:{Authorization:"Bearer ".concat(this.token)}}).then(function(e){console.log(e.data)}).catch(function(e){throw e})},deleteOnce:function(e){var t=this;this.$confirm("确定要删除这条消息吗？, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark(function s(){var a,n;return regeneratorRuntime.wrap(function(s){while(1)switch(s.prev=s.next){case 0:return console.log(1),s.next=3,t.$axios.get("/messages/".concat(e.id,"/del"),{headers:{Authorization:"Bearer ".concat(t.token)}});case 3:return a=s.sent,200===a.code&&(console.log(a.data),t.$message({type:"success",message:"删除成功!"})),s.next=7,t.$axios.get("/messages",{headers:{Authorization:"Bearer ".concat(t.token)}});case 7:n=s.sent,200===n.code&&t.$store.commit("valChange",{type:"messageList",val:n.data});case 9:case"end":return s.stop()}},s)}))).catch(function(e){console.log(e)})},getMessageList:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.$axios.get("messages",{headers:{Authorization:"Bearer ".concat(this.token)}}).then(function(e){var s=e.data.some(function(e){return 2===e.is_read});t.$store.commit("valChange",{type:"haveMesFlag",val:s}),t.$store.commit("valChange",{type:"messageList",val:e.data})}).catch(function(e){throw e});case 1:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},created:function(){var e=this.$tools.getSto("token");this.token=e,this.getMessageList()}},o=r,c=(s("2d9e"),s("17cc")),l=Object(c["a"])(o,a,n,!1,null,"743065a3",null);t["default"]=l.exports},"2d9e":function(e,t,s){"use strict";var a=s("06ba"),n=s.n(a);n.a}}]);